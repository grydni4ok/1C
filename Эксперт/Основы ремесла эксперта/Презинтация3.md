# 12. Включение WSL, установка Ubuntu для Windows

## 12.1. Установка, обновление, установка программ, не установленных по умолчанию  

После установвки Ubuntu в терминале произведем установку необходимых программ. Для этого у нас есть нескольок команд:  
  1. sudo add-apt-repository universe - sudo (SuperUser DO), add-apt-repository — это утилита, предназначенная для добавления репозиториев в систему, universe — это название компонента (репозитория), который мы хотим добавить.
  2. sudo apt update - Обновляем списки пакетов с серверов
  3. sudo apt install atop - устанавливает утилиту мониторинга системы atop (Advanced System & Process Monitor) - это мощный интерактивный мониторинг системы в реальном времени и инструмент для анализа производительности с возможностью ретроспективного просмотра.
  4. sudo apt install nmon - устанавливает утилиту nmon (Nigel's MONitor или Nigel's performance MONitor) — это мощный инструмент мониторинга производительности системы в реальном времени и сбора статистики.
  5. sudo apt install mc - устанавливает Midnight Commander (MC) — классический двухпанельный файловый менеджер для терминала, один из самых популярных инструментов для работы с файлами в Linux.

12.1. Установка, обновление, установка программ, не установленных по умолчанию  
12.2. Минимальный набор команд для навигации и для просмотра/ изменения прав в Linux  

# 13. Просмотр логов технологического журнала  
  
13.1. Соберем созданные логи в одну папку
## 13.2. Простой поиск средствами Notepad++  

Просто поиском в нескольких файлах ищем "TTIMEOUT" или "TDEADLOCK". Находим вхождения и этим можно анализоровать не большие файлы логов.  
  
## 13.3. Простой поиск средствами Linux  

Для поска в Linux системе используем следующую команду:  
  1. `cat */rphost*/*.log | grep TTIMEOUT` - ищет TTIMEOUT в файлах в по указанному пути
  2. `cat */rphost*/*.log | grep TTIMEOUT wc -l` - считает количество TTIMEOUT
  3. `cat */rphost*/*.log | grep TDEADLOCK` - ищет дедлоки и выводит их на экран
  4. `cat */rphost*/*.log | grep TDEADLOCK wc -l` - считает количество вхождений дедлоков на экран.  


## 13.4. Поиск средствами Notepad++ с использованием регулярных выражений  

Регулярными выражениями ищем виновников:  
  1. (199|200)\d{5,},TLOCK - так мы находим срабатывание TLOCK с превышением времени ожидания. В TLOCK не достаточно информации. Рядом с этим TLOCK есть TTIMEOUT. В нем нас интересует WaitConnections, сеанс который мы ожидаем. в моем случае это был WaitConnections=4773. Дальше мы ищем что делал этот сеанс + пространство блокировок.
  2. t:connectID=4773.+?InfoRg55 - это поиск нужного нам сеанса + пространство блокировок
  3. TDEADLOCK - просто ищем дедлоки
  4. TDEADLOCK.+?InfoRg42463 - ищем конкрентный дедлок

## 13.5. Поиск средствами Linux с использованием регулярных выражений  

Регулярные выражения для поиска в Linux:  
  1. `cat */rphost*/*.log | grep -P '(199|200)\d{5,},TLOCK'` - встраиваем регулярные выражения в поиск в Linux
  2. `cat */rphost*/*.log | grep -P 'TDEADLOCK'`
  3. `cat */rphost*/*.log | grep -P 't:connectID=4773.+?InfoRg55'`

## 13.6. Решение вопроса с выводом контекстов при поиске средствами Linux  

Регулярные выражения с контекстом в Linux:
  1. `cat */rphost*/*.log | awk -vORS= '{if(match($0, "^[0-9][0-9]\:[0-9][0-9]\.[0-9]+\-")) print "\n"$0; else print $0;}' | grep -P '(199|200)\d{5,},TLOCK.+?InfoRg' | sed -e "s/\xef\xbb\xbf/ /g" | head`
  2. `cat */rphost*/*.log | awk -vORS= '{if(match($0, "^[0-9][0-9]\:[0-9][0-9]\.[0-9]+\-")) print "\n"$0; else print $0;}' | grep -P 't:connectID=2712.+?InfoRg55' | sed -e "s/\xef\xbb\xbf/ /g" | head`





# 15. Планы запросов  
  
**Важно, не рекомендуется собирать планы запросов на продуктиве! Для postgres такой запрос будет выполняться 2ды. Для msqls так есть часть операций замедляющих базу.**  
    
## 15.1. Планы в консоли запросов в базе на PostgreSQL  

Включение и выключение настройки "Показывать план выполнения запроса", делает запись в файл logcfg.xml, дописыя секции, выдущие логирование запросов с данного сеанса.
Выглядит секция примерно следующий образом:
<!-- ConsoleQueriesBegin 19.01.2026 10:35:26 SRVR="LOCALHOST";REF="SPARKING"; -->
`<log history="2" location="C:\Windows\Temp\v8_871A_1b.1c_logs">`  
`<event>`  
 ` <eq property="name" value="db2"/>`  
 ` <eq property="p:processName" value="sparking"/>`  
`  <eq property="usr" value="Администратор"/>`  
`  <eq property="sessionid" value="5"/>`  
`</event>`  
`<event>`  
`  <eq property="name" value="dbmssql"/>`  
`  <eq property="p:processName" value="sparking"/>`  
`  <eq property="usr" value="Администратор"/>`  
`  <eq property="sessionid" value="5"/>`  
`</event>`  
`<event>`  
`  <eq property="name" value="dbpostgrs"/>`  
`  <eq property="p:processName" value="sparking"/>`  
`  <eq property="usr" value="Администратор"/>`  
`  <eq property="sessionid" value="5"/>`  
`</event>`  
`<event>`  
`  <eq property="name" value="dboracle"/>`  
`  <eq property="p:processName" value="sparking"/>`  
`  <eq property="usr" value="Администратор"/>`  
`  <eq property="sessionid" value="5"/>`  
`</event>`  
`<event>`  
`  <eq property="name" value="SDBL"/>`  
`  <eq property="p:processName" value="sparking"/>`  
`  <eq property="usr" value="Администратор"/>`  
`  <eq property="sessionid" value="5"/>`  
`</event>`  
`<event>`  
`  <eq property="name" value="DBV8DBEng"/>`  
`  <eq property="p:processName" value="sparking"/>`  
`  <eq property="usr" value="Администратор"/>`  
`  <eq property="sessionid" value="5"/>`  
`</event>`  
`<property name="all"/>`  
`  <property name="sql"/>`  
`  <property name="plansqltext"/>`  
`</log>`  

`<plansql/>`  

Секция "SELECT 1 AS SDBL_DUMMY) SDBL_DUAL" указывает на использование RLS.
    
## 15.2. Планы в консоли запросов в базе на MS SQL Server  

Больших отличиий от планов Postgres нет.
  
## 15.3. Ручная настройка ТЖ для сбора планов запросов  

Для ручной настройки ТЖ требуется дописать слудующие фрагменты в файл логов.



  
15.4. Планы запросов в ТЖ, собранных вручную из базы на PostgreSQL
15.5. Планы запросов в ТЖ, собранных вручную из базы на MS SQL Server
15.6. Операторы прохода по таблицам и соединения таблиц (справочно)
















